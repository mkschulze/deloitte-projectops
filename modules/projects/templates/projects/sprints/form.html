{% extends "base.html" %}

{% block title %}{{ ('Sprint bearbeiten' if sprint else 'Neuer Sprint') if lang == 'de' else ('Edit Sprint' if sprint else 'New Sprint') }} - {{ project.name }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-2">
                <li class="breadcrumb-item"><a href="{{ url_for('projects.project_list') }}">{{ 'Projekte' if lang == 'de' else 'Projects' }}</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('projects.project_detail', project_id=project.id) }}">{{ project.name }}</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('projects.sprint_list', project_id=project.id) }}">Sprints</a></li>
                <li class="breadcrumb-item active">{{ ('Bearbeiten' if sprint else 'Neu') if lang == 'de' else ('Edit' if sprint else 'New') }}</li>
            </ol>
        </nav>
        <h1 class="h3 mb-0">
            <i class="bi bi-lightning me-2"></i>
            {{ ('Sprint bearbeiten' if sprint else 'Neuer Sprint') if lang == 'de' else ('Edit Sprint' if sprint else 'New Sprint') }}
        </h1>
    </div>
    
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <form method="POST">
                        <div class="mb-3">
                            <label for="name" class="form-label">
                                {{ 'Name' if lang == 'de' else 'Name' }} <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="name" name="name" 
                                   value="{{ sprint.name if sprint else '' }}" required
                                   placeholder="{{ 'z.B. Sprint 1' if lang == 'de' else 'e.g. Sprint 1' }}">
                        </div>
                        
                        <div class="mb-3">
                            <label for="goal" class="form-label">
                                {{ 'Sprint-Ziel' if lang == 'de' else 'Sprint Goal' }}
                            </label>
                            <textarea class="form-control" id="goal" name="goal" rows="3"
                                      placeholder="{{ 'Was soll in diesem Sprint erreicht werden?' if lang == 'de' else 'What should be achieved in this sprint?' }}">{{ sprint.goal if sprint else '' }}</textarea>
                            <div class="form-text">
                                {{ 'Beschreiben Sie das Ziel dieses Sprints.' if lang == 'de' else 'Describe the goal of this sprint.' }}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="start_date" class="form-label">
                                    {{ 'Startdatum' if lang == 'de' else 'Start Date' }}
                                </label>
                                <input type="date" class="form-control" id="start_date" name="start_date" 
                                       value="{{ sprint.start_date.strftime('%Y-%m-%d') if sprint and sprint.start_date else '' }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="end_date" class="form-label">
                                    {{ 'Enddatum' if lang == 'de' else 'End Date' }}
                                </label>
                                <input type="date" class="form-control" id="end_date" name="end_date"
                                       value="{{ sprint.end_date.strftime('%Y-%m-%d') if sprint and sprint.end_date else '' }}">
                            </div>
                        </div>
                        
                        {% if sprint and sprint.state != 'future' %}
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            {{ 'Dieser Sprint ist bereits ' + ('aktiv' if sprint.state == 'active' else 'abgeschlossen') + '. Einige Änderungen sind möglicherweise eingeschränkt.' if lang == 'de' else 'This sprint is already ' + ('active' if sprint.state == 'active' else 'closed') + '. Some changes may be restricted.' }}
                        </div>
                        {% endif %}
                        
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-deloitte-green">
                                <i class="bi bi-check-lg me-1"></i>
                                {{ 'Speichern' if lang == 'de' else 'Save' }}
                            </button>
                            <a href="{{ url_for('projects.sprint_list', project_id=project.id) }}" class="btn btn-outline-secondary">
                                {{ 'Abbrechen' if lang == 'de' else 'Cancel' }}
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-info-circle me-2"></i>
                        {{ 'Tipps' if lang == 'de' else 'Tips' }}
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="bi bi-check text-success me-2"></i>
                            {{ 'Ein typischer Sprint dauert 1-4 Wochen.' if lang == 'de' else 'A typical sprint lasts 1-4 weeks.' }}
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check text-success me-2"></i>
                            {{ 'Das Sprint-Ziel sollte klar und erreichbar sein.' if lang == 'de' else 'The sprint goal should be clear and achievable.' }}
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check text-success me-2"></i>
                            {{ 'Nur ein Sprint kann gleichzeitig aktiv sein.' if lang == 'de' else 'Only one sprint can be active at a time.' }}
                        </li>
                        <li>
                            <i class="bi bi-check text-success me-2"></i>
                            {{ 'Issues können im Backlog zum Sprint hinzugefügt werden.' if lang == 'de' else 'Issues can be added to the sprint from the backlog.' }}
                        </li>
                    </ul>
                </div>
            </div>
            
            {% if sprint and sprint.issues %}
            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-list-task me-2"></i>
                        {{ 'Issues im Sprint' if lang == 'de' else 'Issues in Sprint' }} ({{ sprint.issues|length }})
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        {% for issue in sprint.issues[:5] %}
                        <li class="mb-2">
                            <a href="{{ url_for('projects.issue_detail', project_id=project.id, issue_key=issue.key) }}" class="text-decoration-none">
                                <span class="badge bg-secondary me-1">{{ issue.key }}</span>
                                {{ issue.summary[:40] }}{% if issue.summary|length > 40 %}...{% endif %}
                            </a>
                        </li>
                        {% endfor %}
                        {% if sprint.issues|length > 5 %}
                        <li class="text-muted small">
                            {{ 'und' if lang == 'de' else 'and' }} {{ sprint.issues|length - 5 }} {{ 'weitere...' if lang == 'de' else 'more...' }}
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

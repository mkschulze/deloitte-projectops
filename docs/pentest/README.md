# OWASP ZAP Konfiguration f√ºr ProjectOps

## üìÅ Dateien

| Datei | Beschreibung |
|-------|--------------|
| `ProjectOps.context` | ZAP Context-Datei zum Importieren |
| `zap_config.py` | Python-Script f√ºr automatische Konfiguration |
| `2026-01-04-ZAP-Report-.json` | Letzter Scan-Report |

---

## üöÄ Option 1: Context-Datei importieren (Einfach)

### Schritt 1: Context importieren
1. √ñffne **OWASP ZAP**
2. **File** ‚Üí **Import Context**
3. W√§hle `ProjectOps.context`
4. Klicke **Open**

### Schritt 2: User hinzuf√ºgen
1. Doppelklick auf **ProjectOps** Context (linke Seite)
2. Gehe zu **Users**
3. Klicke **Add**
4. F√ºlle aus:
   - **Name:** `PentestUser`
   - **Username:** `pentest@zap.local`
   - **Password:** `ZapTest2026!`
   - **Enabled:** ‚úì

### Schritt 3: Forced User aktivieren
1. In der Toolbar: Klicke auf das **Personen-Icon mit Schloss** (Forced User Mode)
2. W√§hle `PentestUser`

### Schritt 4: Scan starten
1. Gehe zu **Quick Start** Tab
2. **URL to attack:** `http://127.0.0.1:5000`
3. Klicke **Attack**

---

## üêç Option 2: Python-Script (Automatisch)

### Voraussetzungen

```bash
# ZAP Python Client installieren
pip install python-owasp-zap-v2.4
```

### ZAP im Daemon-Modus starten

```bash
# macOS
/Applications/OWASP\ ZAP.app/Contents/Java/zap.sh -daemon -port 8080 -config api.key=projectops2026

# Linux
zap.sh -daemon -port 8080 -config api.key=projectops2026

# Windows
zap.bat -daemon -port 8080 -config api.key=projectops2026
```

### Script ausf√ºhren

```bash
cd admin/PENTEST

# Nur konfigurieren (f√ºr GUI-Scan)
python zap_config.py

# Mit Spider-Scan
python zap_config.py --spider-only

# Vollst√§ndiger Scan (Spider + Active Scan)
python zap_config.py --full-scan

# Mit eigenem API-Key
python zap_config.py --api-key DEIN_API_KEY --full-scan
```

---

## üîê Pentest User

| Feld | Wert |
|------|------|
| **Email** | `pentest@zap.local` |
| **Password** | `ZapTest2026!` |
| **Role** | admin |

> ‚ö†Ô∏è Dieser User ist von Rate-Limiting ausgenommen!

### User nach dem Test l√∂schen

```bash
cd /Users/cell/dev/deloitte-projectops
pipenv run flask shell
```

```python
from models import User
from extensions import db
User.query.filter_by(email='pentest@zap.local').delete()
db.session.commit()
```

---

## üìä Reports

Nach dem Scan werden Reports generiert in:
- `admin/PENTEST/zap_full_report.html`
- `admin/PENTEST/zap_full_report.json`

---

## üõ°Ô∏è Rate-Limit Exemption

Der Pentest-User ist von Rate-Limiting ausgenommen durch:

1. **User-Agent Check** - ZAP User-Agent wird erkannt
2. **Email Check** - `pentest@zap.local` ist whitelisted

Konfiguriert in: `extensions.py` ‚Üí `rate_limit_key_func()`

---

## ‚öôÔ∏è Konfigurierte Einstellungen

### Authentication
- **Methode:** Form-based Authentication
- **Login URL:** `http://127.0.0.1:5000/login`
- **POST Data:** `csrf_token={%csrf_token%}&email={%username%}&password={%password%}&remember=on`

### Session Management
- **Methode:** Cookie-based Session Management

### Indicators
- **Logged In:** `Dashboard|logout|Abmelden|Willkommen`
- **Logged Out:** `Anmelden|login|Sign in|Bitte melden`

### Anti-CSRF
- **Token Name:** `csrf_token`

### Excluded URLs
- `*.css`, `*.js`, `*.png`, `*.jpg`, `*.gif`, `*.ico`, `*.woff*`
- `cdn.jsdelivr.net`, `cdn.socket.io`
